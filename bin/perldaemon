#!/usr/bin/env bash

declare -a LIBPATHS=(./lib ../lib /lib /usr/lib /usr/local/lib /opt/lib)

for path in ${LIBPATHS[@]}; do
        if [ -f $path/PerlDaemon/PerlDaemon.pl ]; then
                LIBDIR=$path
                break
        fi
done

function startPD () { perl -I$LIBDIR $LIBDIR/PerlDaemon/PerlDaemon.pl ./conf/perldaemon.conf }
function stopPD () { kill $(cat ./run/perldaemon.pid) }

case $1 in
	start)
	startPD
	;;

	stop)
	stopPD
	;;

	restart)
	stopPD
        startPD
	;;

	logrotate)
	kill -HUP $(cat ./run/perldaemon.pid)
	;;

	*)
	echo "Usage: $0 <start|stop|restart|logrotate>"
	exit 1
	;;
esac

